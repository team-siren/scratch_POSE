<html>
  <head>
    <!-- load tensorflow.js: -->
    <!-- <script src="https://unpkg.com/@tensorflow/tfjs"></script> -->
    <!-- load posenet model: -->
    <!-- <script src="https://unpkg.com/@tensorflow-models/posenet"></script> -->

    <!-- ML5 -->
    <script src="https://unpkg.com/ml5@0.1.3/dist/ml5.min.js"></script>

    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta charset="utf-8" />
  </head>

  <body>
    <h1>image classification using MobileNet</h1>
    <p>
      The MobileNet model labeled this as <span id="result">...</span> with a
      confidence of
      <span id="probability">...</span>
    </p>

    <!-- load stuff for posenet to look at: -->
    <!-- <img id="image" src="bird.jpg" />  -->
    <!-- crossorigin="anonymous"  -->
  </body>

  <script>
    let downloadedImg;
    
    function startDownload() {
      let imageUrl =
        'https://www.yourdentistryguide.com/wp-content/uploads/2017/11/smile-anatomy-min-925x425.jpg';
      downloadedImg = new Image();
      console.log('image:', downloadedImg)
      downloadedImg.crossOrigin = 'Anonymous';
      downloadedImg.addEventListener('load', imageReceived, false);
      downloadedImg.src = imageUrl;
    }

    function imageReceived() {
      let canvas = document.createElement('canvas');
      let context = canvas.getContext('2d');

      canvas.width = downloadedImg.width;
      canvas.height = downloaddedImg.height;

      context.drawImage(downloaddedImg, 0, 0);
      imageBox.appendChild(canvas);

      try {
        localStorage.setItem(
          'saved-image-example',
          canvas.toDataURL('image/png')
        );
      } catch (err) {
        console.error(err);
      }
    }
    
    startDownload()

    //ML5 getting started tutorial
    // const image = document.getElementById('image');
    // const result = document.getElementById('result');
    // const probability = document.getElementById('probability');

    // //initialize the image classifier model
    // const classifier = ml5.imageClassifier('MobileNet', () =>
    //   console.log('model loaded!')
    // );

    // //make a prediction: returns an array w/ default 10 elems and their probabilities
    // classifier.predict(image, (err, results) => {
    //   result.innerText = results[0].className;
    //   probability.innerText = results[0].probability.toFixed(4);
    // });

    //attempted adaptation of the coding train tutorial
    // let video;
    // let poseNet;
    // let noseX = 0;
    // let noseY = 0;
    // let leftEyeX = 0;
    // let leftEyeY = 0;

    // function setup() {
    //   createCanvas(640, 480);
    //   //video will be BELOW the canvas; creates separate DOM element:
    //   video = createCapture(VIDEO);
    //   video.hide();
    //   //I wanna load the poseNet model and connect it to this video
    //   poseNet = ml5.poseNet(video, modelReady);
    //   poseNet.on('pose', gotPoses);
    // }

    // function gotPoses(poses) {
    //   //console.log(poses) //the poses array
    //   //each elem in poses is an object with all the points and certainties
    //   if (poses.length) {
    //     let newNoseX = poses[0].pose.keypoints[0].position.x;
    //     let newNoseY = poses[0].pose.keypoints[0].position.y;
    //     let newEyeX = poses[0].pose.keypoints[1].position.x;
    //     let newEyeY = poses[0].pose.keypoints[1].position.y;
    //     //lerp to stabilize---!
    //     //LERP: linear interolation: finding point between 2 points
    //     //lerp args: val 1, val 2, percentage
    //     //e.g., 6, 10, 5...would be finding the # 50% of the way between (8)
    //     noseX = lerp(noseX, newNoseX, 0.5);
    //     noseY = lerp(noseY, newNoseY, 0.5);
    //     leftEyeX = lerp(leftEyeX, newEyeX, 0.5);
    //     leftEyeY = lerp(leftEyeY, newEyeY, 0.5);
    //   }
    // }

    // function modelReady() {
    //   console.log('model ready');
    // }

    // function draw() {
    //   image(video, 0, 0);

    //   //dist is a built in thing, like lerp, that finds the proportional distance
    //   let diameter = dist(noseX, noseY, leftEyeX, leftEyeY);

    //   fill(255, 0, 0); //r, g, b (0-255)
    //   ellipse(noseX, noseY, diameter);
    //   //fill(0,255,255)
    //   //ellipse(leftEyeX, leftEyeY-120, 30)
    // }

    //FIRST BASIC DEMO: (gets pose array for a still image of a single figure)
    //config
    // const imageScaleFactor = 1
    // const outputStride = 16
    // const flipHorizontal = false
    // const imageElement = document.getElementById('image')

    // // load posenet:
    // posenet.load().then(net=> {
    //   return net.estimateSinglePose(imageElement, imageScaleFactor, flipHorizontal, outputStride)
    // }).then(pose=> console.log(pose))
  </script>
</html>
